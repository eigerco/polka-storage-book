<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Real-world use case demo - Polka Storage</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../getting-started/index.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/local-testnet.html"><strong aria-hidden="true">2.1.</strong> Local Testnet - Polka Storage Parachain</a></li><li class="chapter-item expanded "><a href="../getting-started/car-server.html"><strong aria-hidden="true">2.2.</strong> CAR server</a></li><li class="chapter-item expanded "><a href="../getting-started/demo.html" class="active"><strong aria-hidden="true">2.3.</strong> Real-world use case demo</a></li></ol></li><li class="chapter-item expanded "><a href="../storage-provider-cli/index.html"><strong aria-hidden="true">3.</strong> Polka Storage Provider CLI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../storage-provider-cli/storage.html"><strong aria-hidden="true">3.1.</strong> storage</a></li><li class="chapter-item expanded "><a href="../storage-provider-cli/wallet.html"><strong aria-hidden="true">3.2.</strong> wallet</a></li></ol></li><li class="chapter-item expanded "><a href="../storagext-cli/index.html"><strong aria-hidden="true">4.</strong> Storagext CLI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../storagext-cli/market.html"><strong aria-hidden="true">4.1.</strong> market</a></li><li class="chapter-item expanded "><a href="../storagext-cli/storage-provider.html"><strong aria-hidden="true">4.2.</strong> storage-provider</a></li><li class="chapter-item expanded "><a href="../storagext-cli/system.html"><strong aria-hidden="true">4.3.</strong> system</a></li></ol></li><li class="chapter-item expanded "><a href="../pallets/index.html"><strong aria-hidden="true">5.</strong> Pallets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../pallets/market.html"><strong aria-hidden="true">5.1.</strong> Market</a></li><li class="chapter-item expanded "><a href="../pallets/storage-provider.html"><strong aria-hidden="true">5.2.</strong> Storage Provider</a></li></ol></li><li class="chapter-item expanded "><a href="../glossary.html"><strong aria-hidden="true">6.</strong> Glossary</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Polka Storage</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="real-world-use-case-demo"><a class="header" href="#real-world-use-case-demo">Real-world use case demo</a></h1>
<div class="warning">
Before reading this guide,
please ensure you've followed the <a href="./local-testnet.html">local testnet</a> guide and that a working testnet is running!
</div>
<p>A high-level overview with diagrams of the process described below can be found in <a href="../pallets/index.html">Pallets section</a>.</p>
<h2 id="1-publishing-a-deal"><a class="header" href="#1-publishing-a-deal">1. Publishing a deal</a></h2>
<p>Charlie heard he could provide storage to people worldwide and earn some tokens,
so he decided to register as a <a href="../glossary.html">Storage Provider</a>.</p>
<pre><code class="language-bash">$ storagext-cli --sr25519-key "//Charlie" storage-provider register Charlie
[0xd14d…4b6a] Storage Provider Registered: { owner: 5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y, info: Storage Provider Info: { peer_id: 3ZAB4sc5BS, window_post_proof_type: StackedDRGWindow2KiBV1P1, sector_size: _2KiB, window_post_partition_sectors: 2 }, proving_period_start: 21 }
</code></pre>
<img src="../images/demo/registered-charlie.PNG">
<p>Alice is a <a href="../glossary.html#storage-user">Storage User</a> and wants to store an image of her lovely Husky (<code>husky.jpg</code>) in the Polka Storage <a href="../glossary.html#parachain">parachain</a>.</p>
<p>Alice knows<sup class="footnote-reference"><a href="#no-cid">1</a></sup> that she needs to get a <a href="https://github.com/multiformats/cid">CID</a> of the image,
so she <a href="../storage-provider-cli/storage.html#upload-a-file">uploaded it to the CAR server</a>
and received the CID: <code>bafybeihxgc67fwhdoxo2klvmsetswdmwwz3brpwwl76qizbsl6ypro6vxq</code>.</p>
<p>Alice heard somewhere<sup class="footnote-reference"><a href="#no-sp-discovery">2</a></sup> in the hallways of her favourite gym that Charlie is a Storage Provider.
She calls him (off-chain), and they negotiate a deal:</p>
<p><code>husky-deal.json</code></p>
<pre><code class="language-json">[
  {
    "piece_cid": "bafybeihxgc67fwhdoxo2klvmsetswdmwwz3brpwwl76qizbsl6ypro6vxq",
    "piece_size": 1278,
    "client": "5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY",
    "provider": "5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y",
    "label": "My lovely Husky (husky.jpg)",
    "start_block": 25,
    "end_block": 50,
    "storage_price_per_block": 1000000000,
    "provider_collateral": 12500000000,
    "state": "Published"
  }
]
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>piece_cid</code></td><td><code>bafybeihxgc67fwhdoxo2klvmsetswdmwwz3brpwwl76qizbsl6ypro6vxq</code></td><td>The submitted file's CID</td></tr>
<tr><td><code>piece_size</code></td><td><code>1278</code></td><td>The submitted file's size</td></tr>
<tr><td><code>client</code></td><td><a href="https://docs.substrate.io/reference/glossary/#dev-phrase"><code>//Alice</code></a> or <code>5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY</code></td><td>The client's address</td></tr>
<tr><td><code>provider</code></td><td><a href="https://docs.substrate.io/reference/glossary/#dev-phrase"><code>//Charlie</code></a> or <code>5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y</code></td><td>The providers's address</td></tr>
<tr><td><code>start_block</code></td><td><code>25</code></td><td>When the deal should start</td></tr>
<tr><td><code>end_block</code></td><td><code>50</code></td><td>When the deal should end</td></tr>
<tr><td><code>storage_price_per_block</code></td><td><code>1_000_000_000</code></td><td>In <a href="../glossary.html#planck">Plancks</a>, the storage price per block (12 sec)</td></tr>
<tr><td><code>provider_collateral</code></td><td><code>12_500_000_000</code></td><td>In <a href="../glossary.html#planck">Plancks</a>, the price paid by the storage provider if they fail to uphold their end of the deal</td></tr>
</tbody></table>
</div>
<p>After the negotiation, they need to <a href="../pallets/market.html#add_balance">add funds to the Pallet</a> and then <a href="../pallets/market.html#publish_storage_deals">publish their intent</a> so it can be checked by the parachain.
So here they go:</p>
<pre><code class="language-bash"># Adding balance to Alice's account
$ storagext-cli --sr25519-key "//Alice" market add-balance 25000000000
[0xe0bd…06f9] Balance Added: { account: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY, amount: 25000000000 }
# Adding balance to Charlie's account
$ storagext-cli --sr25519-key "//Charlie" market add-balance 12500000000
[0x25aa…edd3] Balance Added: { account: 5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y, amount: 12500000000 }
# Publishing their deal
$ storagext-cli --sr25519-key  "//Charlie" market publish-storage-deals --client-sr25519-key  "//Alice" "@husky-deal.json"
[0xd50b…dee6] Deal Published: { deal_id: 0, provider_account: 5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y, client_account: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY }
</code></pre>
<div class="footnote-definition" id="no-cid"><sup class="footnote-definition-label">1</sup>
<p>We have not provided a standalone command to generate CID out of the file. The CAR server is a temporary showcase component.</p>
</div>
<div class="footnote-definition" id="no-sp-discovery"><sup class="footnote-definition-label">2</sup>
<p>We have not yet implemented Storage Provider Discovery protocol.</p>
</div>
<h2 id="2-committing-a-deal"><a class="header" href="#2-committing-a-deal">2. Committing a deal</a></h2>
<p>After the deals have been published, the rest is up to Charlie.
If Charlie does not behave appropriately, <a href="../pallets/storage-provider.html#pre_commit_sector">pre-commit</a> and <a href="../pallets/storage-provider.html#prove_commit_sector">prove</a> the deal by block 25 (<code>start_block</code>),
he will be slashed, and all his funds <a href="../glossary.html#collateral">(<code>provider_collateral</code>)</a> will be gone.<sup class="footnote-reference"><a href="#slash">3</a></sup>
So he should do his part!</p>
<p><code>pre-commit-husky.json</code></p>
<pre><code class="language-json">{
  "sector_number": 1,
  "sealed_cid": "bafk2bzaceajreoxfdcpdvitpvxm7vkpvcimlob5ejebqgqidjkz4qoug4q6zu",
  "deal_ids": [0],
  "expiration": 75,
  "unsealed_cid": "bafk2bzaceajreoxfdcpdvitpvxm7vkpvcimlob5ejebqgqidjkz4qoug4q6zu",
  "seal_proof": "StackedDRG2KiBV1P1"
}
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="../glossary.html#sector"><code>sector_number</code></a></td><td>1</td><td>The place where <code>husky.jpg</code> will be stored. Charlie decided it'll be on his 1st sector.</td></tr>
<tr><td><code>deal_ids</code></td><td><code>[0]</code></td><td>A sector can contain multiple deals, but it only contains the first one ever created (id: 0).</td></tr>
<tr><td><code>expiration</code></td><td><code>75</code></td><td>The 75th block is 5 minutes after the <code>end_block</code>, so the sector expires only after the deal has been terminated.</td></tr>
<tr><td><a href="../glossary.html#commitment-of-replication"><code>sealed_cid</code></a>, <a href="../glossary.html#commitment-of-data"><code>unsealed_cid</code></a>,</td><td>multiple</td><td>Currently, placeholder values (any CID) since the proof mechanism is a work-in-progress.</td></tr>
<tr><td><code>seal_proof</code></td><td><code>StackedDRG2KiBV1P1</code></td><td>Currently, we only accept sector sizes of 2KiB, so this is the only value possible.</td></tr>
</tbody></table>
</div>
<p><code>prove-commit-husky.json</code></p>
<pre><code class="language-json">{
  "sector_number": 1,
  "proof": "1230deadbeef"
}
</code></pre>
<ul>
<li><code>proof</code>: hex string of bytes of the proof, it's WIP, so any non-zero value works.</li>
</ul>
<pre><code class="language-bash">$ storagext-cli --sr25519-key "//Charlie" storage-provider pre-commit "@pre-commit-husky.json"
[0xf2ad…dc3d] Sector Pre-Committed: { owner: 5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y, sector_number: Sector Pre-Commit Info: { sector_number: 1, expiration: 75, seal_proof: RegisteredSealProof::StackedDRG2KiBV1P1, unsealed_cid: bafk2bzaceajreoxfdcpdvitpvxm7vkpvcimlob5ejebqgqidjkz4qoug4q6zu, sealed_cid: bafk2bzaceajreoxfdcpdvitpvxm7vkpvcimlob5ejebqgqidjkz4qoug4q6zu } }
$ storagext-cli --sr25519-key "//Charlie" storage-provider prove-commit "@prove-commit-husky.json"
[0x0743…6fd3] Sector Proven: { owner: 5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y, sector_number: 1, partition_number: 0, deadline_idx: 0 }
</code></pre>
<img src="../images/demo/proven.PNG">
<div class="footnote-definition" id="slash"><sup class="footnote-definition-label">3</sup>
<p>You can wait for 5 minutes and observe a <code>DealSlashed</code> <a href="../pallets/market.html#events">Event</a> being published.</p>
</div>
<h2 id="3-proofs-and-faults"><a class="header" href="#3-proofs-and-faults">3. Proofs and faults</a></h2>
<h3 id="aside-on-deadlines"><a class="header" href="#aside-on-deadlines">Aside on Deadlines</a></h3>
<p>There is a little something that Charlie needs to know about: deadlines <em>(don't we all...)</em>.</p>
<p>Each Storage Provider has a Proving Period, a time divided into segments (deadlines).
To simplify, let's say a proving period lasts a day (24 hours), and between the start and end of each hour, there is a segment, just like on a clock.</p>
<img src="../images/proving-period-deadlines.svg">
<p>Now, when Charlie gathers enough data and stores it in a sector, he must keep proving that he has some data.
Charlie can have multiple sectors and he doesn't want to overload the system by proving all of them simultaneously.
So what if each sector got assigned a segment (1 hour) during the day, and Charlie would need to submit proof that he has data roughly on the same hour each day?
That'd work, right?</p>
<p>So this is what a Proving Period and Deadlines are.
We divide a proving period into deadlines and when we prove commit, we assign a sector to a deadline.
From now on, the sector must be proven periodically and daily during this lifetime.</p>
<p><code>windowed-post.json</code></p>
<pre><code class="language-json">{
  "deadline": 0,
  "partitions": [0],
  "proof": {
    "post_proof": "2KiB",
    "proof_bytes": "1230deadbeef"
  }
}
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>deadline</code></td><td><code>0</code></td><td>the deadline index which has been assigned by the Prove Commit</td></tr>
<tr><td><code>partitions</code></td><td><code>[0]</code></td><td>the partitions which have been assigned by Prove Commit</td></tr>
<tr><td><code>post_proof</code></td><td>"2KiB"</td><td>we only support sectors of size 2KiB for now, so it's the only possible value</td></tr>
<tr><td><code>proof_bytes</code></td><td><code>0x1230deadbeef</code></td><td>hex string of bytes of the proof, it's WIP, so any non-zero value works</td></tr>
</tbody></table>
</div>
<p>Now that the sector has been proven, Charlie must keep confirming that he stores the data.
Charlie's proving period starts at block <code>21</code> (as <code>register-storage-provider</code> tells us), so the first deadline is between blocks <code>[21, 31)</code>, second <code>[31, 41)</code>.
That's because there are <a href="#const-period-deadlines">2 deadlines</a> within a <a href="#const-proving-period">proving period</a>, and a deadline has a <a href="#const-challenge-window">window of 10 blocks</a>.
Charlie got assigned the first deadline, so he waits until block <code>21</code> to send the proof that he still stores the data.</p>
<pre><code class="language-bash">$ storagext-cli --sr25519-key "//Charlie" storage-provider submit-windowed-post "@windowed-post.json"
[0x3aa1…a12a] Valid PoSt Submitted: { owner: 5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y }
</code></pre>
<img src="../images/demo/post-submitted.PNG">
<p>The next proving period starts at block <code>41</code>, with the deadline <code>[41, 51)</code>, so Charlie must submit his proof on this block.
He knows he won't be able to create a proof, as his hard drives went down, so he reports it. If he didn't report, he'd get slashed.</p>
<p><code>fault-declaration.json</code></p>
<pre><code class="language-json">[
  {
    "deadline": 0,
    "partition": 0,
    "sectors": [1]
  }
]
</code></pre>
<pre><code class="language-bash">$ storagext-cli --sr25519-key "//Charlie" storage-provider declare-faults "@fault-declaration.json"
[0x49cd…9a88] Faults Declared: { owner: 5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y, faults: [Fault Declaration: { deadline: 0, partition: 0, sectors: [1] }] }
</code></pre>
<img src="../images/demo/faults-declared.PNG">
<p>Charlie fixed his issues with storage and now wants to declare that he can still provide data in this sector.
If he does this too late (1 minute before the next deadline starts), he won't be able to.</p>
<pre><code class="language-bash">$ storagext-cli --sr25519-key "//Charlie" storage-provider declare-faults-recovered "@fault-declaration.json"
Error: Runtime error: Pallet error: StorageProvider::FaultRecoveryTooLate

Caused by:
    Pallet error: StorageProvider::FaultRecoveryTooLate
</code></pre>
<p>If he does it at least a minute before, it succeeds:</p>
<pre><code class="language-bash">$ storagext-cli --sr25519-key "//Charlie" storage-provider declare-faults-recovered "@fault-declaration.json"
[0xca6b…875c] Faults Recovered: { owner: 5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y, recoveries: [Recovery Declaration: { deadline: 0, partition: 0, sectors: [1] }] }
</code></pre>
<p>And then, at the next deadline, in the next proving period <code>[41, 51)</code> he needs to remember to submit windowed PoSt again.</p>
<pre><code class="language-bash">$ storagext-cli --sr25519-key "//Charlie" storage-provider submit-windowed-post "@windowed-post.json"
[0x3e46…5636] Valid PoSt Submitted: { owner: 5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y }
</code></pre>
<h2 id="4-reaping-the-rewards"><a class="header" href="#4-reaping-the-rewards">4. Reaping the rewards</a></h2>
<p>After the deal ends (after block <code>50</code>), Charlie goes to get his rewards!
First, he settles all of the locked funds, so his balance gets unlocked, and then he withdraws the balance from his Market account to use his DOTs for a new shiny dumbbell.</p>
<pre><code class="language-bash">$ storagext-cli --sr25519-key "//Charlie" market settle-deal-payments 0
[0x1633…d17b] Deals settled: { successful: [Settled Deal { deal_id: 0, provider_account: 5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y, client_account: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY, amount: 25000000000 }], unsuccessful: [] }
$ storagext-cli --sr25519-key "//Charlie" market withdraw-balance 37500000000
[0x0197…bdd9] Balance Withdrawn: { account: 5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y, amount: 37500000000 }
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../getting-started/car-server.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../storage-provider-cli/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../getting-started/car-server.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../storage-provider-cli/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
